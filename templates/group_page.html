{% extends 'base.html' %}

{% block content %}
    <div class="well well">
        {% if is_member %}
            <button class="btn btn-danger pull-right" data-toggle="modal" data-target=".bs-example-modal-sm">Leave a group</button>
{#            <button id="leave_{{ group.id }}" class="leave_group btn btn-danger pull-right" group-id="{{ group.id }}" value="{{ csrf_token }}">Leave a group</button>#}
            <pre id="leave_mess_{{ group.id }}" class="leave_mess pull-right" style="display: none">Leaved</pre>
        {% endif%}
        <h4>{{ group.name }}</h4>
    </div>
    <div class="row">
{#        #}

        <div class="modal bs-example-modal-sm" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header"><h4>Leave</h4></div>
                    <div class="modal-body"><i class="fa fa-question-circle"></i> Are you sure you want to leave a group?
                    </div>
                    <div class="modal-footer">
                        <button id="leave_{{ group.id }}"
                                class="btn btn-primary btn-block leave_group"
                                group-id="{{ group.id }}" value="{{ csrf_token }}">
                            leave
                        </button>
                    </div>
                </div>
            </div>
        </div>
    {% if public_group %}
        <div id="profile_sidebar" class="col-md-4">
            <div>
                <div class="panel" id="performance">
                    <h4><strong>
                        {{ uname }} Performance
                    </strong></h4>

                    <p>{{ group.name|capfirst }}'s number of Forecasts: {{ forecasts|length|default:"0" }}</p>

                </div>

                {% if not hide_analysis_box %}
                    <div class="panel" id="analysis">
                        <h4><strong>
                            {% if owner %} My {% else %}
                                {{ group.name }}'s
                            {% endif %} Analysis
                        </strong></h4>

                        <p>Published Analysis: {{ analysis|length|default:"0" }}
                            {#                            <a href="{% url 'profile_forecast_analysis' id=profile.id %}"#}
                            {#                                class="pull-right">[See Full Set]</a></p>#}
                            <a href="#">[See Full Set]</a></p>
                        {% for element in analysis %}
                            <div>
                                <a class="list-group-item" href="{% url 'individual_forecast' id=element.forecast.id %}#analysis-{{ element.id }}"
                                   target="_blank"
                                   data-toggle="modal" data-target="#id{{ element.id }}">{{ element.title }}</a>
                            </div>

                            <div class="modal fade" id="id{{ element.id }}" tabindex="-1" role="dialog"
                                 aria-labelledby="myModalLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                                    aria-hidden="true">&times;</span></button>
                                            <h4 class="modal-title" id="myModalLabel">
                                                <strong>{{ element.title }}</strong></h4>
                                        </div>
                                        <div class="modal-body">
                                            {{ element.body }}
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {% empty %}
                            <div class="well well-sm">There are no posted analysis</div>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="panel">

                    <div class="modal fade" id="Fol" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                            aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">Followers</h4>
                                </div>
                                <div class="modal-body">

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="FolUsers" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                            aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">Followed Users</h4>
                                </div>
                                <div class="modal-body">
                                    ...
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel" id="info">
                        <h4><strong>{{ uname }} Description</strong></h4>
                        {% if group.description %}
                            <p>About group: {{ group.description }}</p>
                        {% else %}
                            <p>Empty</p>
                        {% endif %}
                    </div>

{# Followers and  Requests#}

                    <div id="admin_of_group" style="margin-top: 10px">
                        <div class="panel panel-default">
                            <div class="panel-heading">Admins: {{ admins_group|length|default:"0" }}</div>
                            <div id="peleus-right-toggle-wrap ">
                                <div class="followers-scrollable-block">
                                    {% for admin in admins_group %}
                                        <li class="list-group-item">
                                            <a href="{% url 'profile' id=admin.id %}" target="_blank">{{ admin }}
                                            </a>
                                        </li>
                                    {% empty %}
                                        <pre>No admins, you can be first</pre>
                                    {% endfor %}
                                </div>
                            </div>

                        </div>
                    </div>


                    <div id="req_to_group" style="margin-top: 10px">
                        <div class="panel panel-default">
                            <div class="panel-heading">Followers: {{ followers|length|default:"0" }}</div>
                            <div id="peleus-right-toggle-wrap ">
                                <div class="followers-scrollable-block">
                                    {% for follow in followers %}
                                        <li id="followers_items" class="list-group-item" value="{{ group.id }}">
                                            <a href="{% url 'profile' id=follow.id %}" target="_blank">{{ follow }}
                                            </a>
                                            {% if has_admin_rights %}
                                                <a href="" class="delete_follower glyphicon glyphicon-minus pull-right" delete-user="{{ follow.id }}"></a>
                                             {% endif %}
                                        </li>
                                    {% empty %}
                                        <pre>No followers...</pre>
                                    {% endfor %}
                                </div>
                            </div>

                        </div>
                    </div>
                    {% if has_admin_rights %}
                    <div id="req_to_group" style="margin-top: 10px">
                        <div class="panel panel-default">
                            <div class="panel-heading">Requests: {{ requests|length|default:"0" }}</div>
                            <div id="peleus-right-toggle-wrap">
                                <div class="peleus-right-toggle collapse in">
                                    {% for request in requests %}
                                        <li id="join_group" class="join_to_group_{{ request.id }} list-group-item" value="{{ group.id }}">{{ request }}
                                            <a href="" class="cancel_join glyphicon glyphicon-minus pull-right" leave-user="{{ request.id }}"></a>
                                            <a href="" class="access_join  pull-right glyphicon glyphicon-plus" join-user="{{ request.id }}">
                                            </a>
                                        </li>
                                    {% empty %}
                                        <pre>No requests...</pre>
                                    {% endfor %}
                                </div>
                            </div>

                        </div>
                    </div>
                {% endif %}
{# Followers and  Requests#}

                </div>
            </div>
        </div>


        <div class="col-md-8">
            <div>
                <p><strong>
                    {% if owner %} My {% else %}
                        {{ group.name }}'s
                    {% endif %}
                    Active Forecasts
                    {% if forecasts|length >= 5 %}
                        <a href="#" data-toggle="modal" data-target="#active_group_forecasts">[See Full Set]</a>
                    {% endif %}
                </strong>
                </p>
            </div>
            <table class="table">
                {% for forecast in forecasts %}
                    <tr>
                        <td>
                            <a style="text-decoration: none;" href="{% url 'individual_forecast' id=forecast.id %}">{{ forecast.forecast_question }}</a>
                            <div> the Forecast Period End Date - {{ forecast.end_date }}</div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td>
                            Empty active forecasts list
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>

        <div class="col-md-8">
            <div>
                <p><strong>
                    {% if owner %} My {% else %}
                        {{ group.name }}'s
                    {% endif %}
                    Archived Forecasts
                    {% if forecasts_archived|length >= 5 %}
                        <a href="#" data-toggle="modal" data-target="#">[See Full Set]</a>
                    {% endif %}
                </strong></p>
                <table class="table">
                    {% for forecast in forecasts_archived %}
                        <tr>
                            <td>
                                <a href="{% url 'individual_forecast' id=forecast.id %}">{{ forecast.forecast_question }}</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td>
                                Empty archived forecasts list
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>



            <div class="modal fade" id="archived_forecasts" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModaLabel">Archived Forecasts</h4>
                        </div>
                        <div class="modal-body" id="archived-set-modal">
                            ...
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade bs-example-modal-lg" id="active_group_forecasts" tabindex="-1" role="dialog"
                 aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModaLabel">Active Forecasts: {{ forecasts|length }}</h4>
                        </div>
                        <div class="modal-body" id="active-set-modal">
                            {% for forecast in forecasts %}
                                <div class="list-group-item">
                                    <a href="{% url 'individual_forecast' id=forecast.id %}">{{ forecast|slice:"60" }}</a>
                                <label class="pull-right">  the Forecast Period End Date - {{ forecast.end_date }}</label>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

{#    #}
        {% else %}
            <label class="col-sm-12 text-center well well-lg">Please wait until your request would be considered</label>
    {% endif %}
    </div>

{% endblock %}

{% block postbodyscripts %}
    {% load staticfiles %}
    <script src="{% static '1p/home_page_charts.js' %}"></script>
    <script src="{% static '1p/forecasts_for_groups.js' %}"></script>
    <script src="{% static '1p/join_to_group.js' %}"></script>
{% endblock %}
